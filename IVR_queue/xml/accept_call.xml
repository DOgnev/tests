<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE scenario SYSTEM "sipp.dtd">
<scenario name = "new_script">

<recv request="INVITE">
	<action>
		<ereg regexp="[0-9]+" search_in="hdr" header="CSeq:" assign_to="last_cseq"/>
		<ereg regexp="(\w|-)*" search_in="hdr" header="branch=" assign_to="last_branch"/>
	</action>
</recv>

<send crlf="true">
<![CDATA[
    SIP/2.0 100 Trying
    Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[$last_branch]
    [last_from:]
    [last_to:];
    [last_call-id:]
    CSeq: [$last_cseq] INVITE
    Subject: ivr_queue_test
    Allow: INVITE, ACK, BYE, CANCEL, INFO, MESSAGE, NOTIFY, OPTIONS, REFER, UPDATE, PRACK
    Content-Length: 0
]]>
</send>

<send crlf="true">
<![CDATA[
    SIP/2.0 180 Ringing
    Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[$last_branch]
    [last_from:]
    [last_to:]; tag=[pid]SIPpTag01[call_number]
    [last_call-id:]
    CSeq: [$last_cseq] INVITE
    Subject: ivr_queue_test
    Contact: <sip:[service]@[local_ip]:[local_port]>
    Allow: INVITE, ACK, BYE, CANCEL, INFO, MESSAGE, NOTIFY, OPTIONS, REFER, UPDATE, PRACK
    Content-Length: 0
]]>
</send>

<send crlf="true">
<![CDATA[
    SIP/2.0 200 OK
    Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[$last_branch]
    [last_from:]
    [last_to:]; tag=[pid]SIPpTag01[call_number]
    [last_call-id:]
    CSeq: [$last_cseq] INVITE
    Subject: ivr_queue_test
    Contact: <sip:[service]@[local_ip]:[local_port]>
    Allow: INVITE, ACK, BYE, CANCEL, INFO, MESSAGE, NOTIFY, OPTIONS, REFER, UPDATE, PRACK
    Content-Length: 0
]]>
</send>

<recv request="ACK">
<action>
<ereg regexp="sip:([^@]@)?[^>]+" search_in="hdr" header="From:" check_it="true" assign_to="frome"/>
<ereg regexp=".*" search_in="hdr" header="From:" check_it="true" assign_to="from"/>
<ereg regexp=".*" search_in="hdr" header="To:" check_it="true" assign_to="to"/>
</action>
</recv>

<pause milliseconds="1000" crlf="true"/>

<send>
<![CDATA[
    BYE [$frome] SIP/2.0
    Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
    From: [$to]
    To: [$from]
    [last_call-id:]
    CSeq: [cseq] BYE
    Max-Forwards: 70
    Subject: ivr_queue_test
    Content-Length: 0
]]>
</send>

<recv response="200"></recv>

</scenario>
