{
	"TestName": "Follow_me_dname_check",
    "AutoTest" : true,
    "Users" : [
        {
        	"UserId": 0,
            "Number": "5120",
            "Login": "5120",
            "Password": "test123",
            "SipDomain": "test.domain",
            "Expires": 90,
            "Port": 10105,
            "SipGroup": "sip.ab"
        },
        {
            "UserId": 1,
            "Number": "5100",
            "Login": "5100",
            "Password": "test123",
            "SipDomain": "test.domain",
            "Expires": 90,
            "Port": 10106,
            "SipGroup": "sip.ab"
        },
        {
            "UserId": 2,
            "Number": "5190",
            "Login": "5190",
            "Password": "test123",
            "SipDomain": "test.domain",
            "Expires": 90,
            "Port": 10107,
            "SipGroup": "sip.ab"
        }
    ],
    "UserVar" : [
        {
        	"%%FollowMeCode%%": "23",
            "%%UserPin%%": "2123",
            "%%SIP_DNAME%%" : "SipDNAME_Follow_me_sip",
            "%%ALIAS_DNAME%%" : "SipDNAME_Follow_me_alias",
            "%%ROUTE_DNAME%%" : "SipDNAME_Follow_me_route",
            "%%FOLLOW_ME_ROUTE_CONTEXT%%" : "PGNvbnRleHQgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4czpub05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uPSJlY3NzX3JvdXRpbmcueHNkIiBuYW1lPSJmb2xsb3dfbWVfY3R4IiBkaWdpdG1hcD0iKCpbMC05Kl1bMC05Kl0uI3wjWzAtOSpdWzAtOSpdLiN8KiNbMC05Kl1bMC05Kl0uI3wxeHgufDEweHguKSI+CiAgPHJ1bGUgbmFtZT0icnVsZTEiPgogICAgPGNvbmRpdGlvbnM+CiAgICAgIDxjZHBuIGRpZ2l0cz0iJSIvPgogICAgICA8ZmluYWwgdmFsdWU9InRydWUiLz4KICAgIDwvY29uZGl0aW9ucz4KICAgIDxhY3Rpb25zPgogICAgICA8Y2FsbGluZyBkaXNwbGF5X25hbWU9IlNpcEROQU1FX0ZvbGxvd19tZV9yb3V0ZSIvPgogICAgPC9hY3Rpb25zPgogICAgPHJlc3VsdD4KICAgICAgPGxvY2FsLz4KICAgIDwvcmVzdWx0PgogIDwvcnVsZT4KPC9jb250ZXh0Pg=="
        }
    ],
    "PreConf" :[
        {
        	"command1" : "/domain/%%DEV_DOM%%/alias/set %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% ss\\mgm\\telephone enabled",
        	"command2" : "/domain/%%DEV_DOM%%/alias/set %%1.Number%% %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% ss\\mgm\\telephone enabled",
            "command3" : "/domain/%%DEV_DOM%%/alias/set %%2.Number%% %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% ss\\mgm\\telephone enabled",
            "command4" : "/domain/%%DEV_DOM%%/ss/enable %%1.Number%% follow_me"    	
        }
    ],
    "PostConf" : [
        {
        	"command1" : "/domain/%%DEV_DOM%%/alias/clean %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% ss\\mgm\\telephone enabled",
        	"command2" : "/domain/%%DEV_DOM%%/alias/clean %%1.Number%% %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% ss\\mgm\\telephone enabled",
            "command3" : "/domain/%%DEV_DOM%%/alias/clean %%2.Number%% %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% ss\\mgm\\telephone enabled",
            "command4" : "/domain/%%DEV_DOM%%/ss/disable %%1.Number%% follow_me"
        }
    ],
    "Tests" : [
        {
             "Name": "follow_me_set_dname_only_sip",
             "Description": "dName получен через SIP, на абоненте не выставлен, на маршрутизации не выставлен. На стороне Б ожидаем dName с SIP",
             "TestProcedure": [
             	 {
                     "ServiceFeature": [
                         {
                             "code" : "*%%FollowMeCode%%*%%UserPin%%#",
                             "userId" : 1
                         }
                     ]
             	 },
             	 {
             	 	"ServiceFeature": [
                         {
                             "code" : "*%%FollowMeCode%%*%%UserPin%%*%%1.Number%%#",
                             "userId" : 2
                         }
                     ]
             	 },
                 {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%SIP_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set DISPLAY_NAME %%SIP_DNAME%%",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                 }
             ]
        },
        {
            "Name": "follow_me_set_dname_on_sip_and_alias",
            "Description": "dName получен через SIP, на абоненте выставлен, на маршрутизации не выставлен. На стороне Б ожидаем dName с alias",
            "TestProcedure": [
                {
                    "SendSSHCommand" : [
                        {
                            "command1" : "/domain/%%DEV_DOM%%/alias/set %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName %%ALIAS_DNAME%%"
                        }
                    ]
                },
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ALIAS_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set DISPLAY_NAME %%SIP_DNAME%%",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                    "SendSSHCommand" : [
                        {
                            "command1" : "/domain/%%DEV_DOM%%/alias/clean %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName"
                        }
                    ]
                }
            ]
        },
        {
        	"Name": "follow_me_wout_dname",
        	"Description": "dName не получен через SIP, на абоненте не выставлен, на маршрутизации не выставлен. На стороне Б ожидаем \"\"",
        	"TestProcedure" : [
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME \"\"",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set WOUT_DNAME TRUE",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                }                                 
        	]
        },
        {
            "Name": "follow_me_set_dname_only_alias",
            "Description": "dName не получен через SIP, на абоненте выставлен, на маршрутизации не выставлен. На стороне Б ожидаем dName с alias",
            "TestProcedure" : [
            	 {
                    "SendSSHCommand" : [
                        {
                            "command1" : "/domain/%%DEV_DOM%%/alias/set %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName %%ALIAS_DNAME%%"
                        }
                    ]
                },
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ALIAS_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set WOUT_DNAME TRUE",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                    "SendSSHCommand" : [
                        {
                            "command1" : "/domain/%%DEV_DOM%%/alias/clean %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName"
                        }
                    ]
                }            
            ]
        },
        {
        	"Name": "follow_me_set_dname_on_sip_and_routing",
        	"Description": "dName получен через SIP, на абоненте не выставлен, на маршрутизации выставлен. На стороне Б ожидаем dName с маршрутизации",
        	"TestProcedure" : [
                {
                	"SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%FOLLOW_ME_ROUTE_CONTEXT%%",
                        	"command2" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context follow_me_ctx"
                        }
                	]
                },
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ROUTE_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set DISPLAY_NAME %%SIP_DNAME%%",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                	"SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/routing/delete follow_me_ctx",
                        	"command2" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context default_routing"
                        }
                	]
                }
        	]
        },
        {
        	 "Name": "follow_me_set_dname_on_sip_and_alias_and_routing",
        	 "Description": "dName получен через SIP, на абоненте выставлен, на маршрутизации выставлен. На стороне Б ожидаем dName с маршрутизации",
        	 "TestProcedure" : [
                 {
                 	"SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/alias/set %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName %%ALIAS_DNAME%%",
                        	"command2" : "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%FOLLOW_ME_ROUTE_CONTEXT%%",
                            "command3" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context follow_me_ctx"
                        }
                 	]
                 },
                 {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ROUTE_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set DISPLAY_NAME %%SIP_DNAME%%",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                    "SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/alias/clean %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName",
                        	"command1" : "/domain/%%DEV_DOM%%/routing/delete follow_me_ctx",
                        	"command2" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context default_routing"
                        }
                    ]	
                }
        	 ]
        },
        {
        	"Name": "follow_me_set_dname_only_routing",
        	"Description": "dName не получен через SIP, на абоненте не выставлен, на маршрутизации выставлен. На стороне Б ожидаем dName с маршрутизации",
        	"TestProcedure" : [
                {
                	"SendSSHCommand" : [
                        {
                        	"command1": "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%FOLLOW_ME_ROUTE_CONTEXT%%",
                            "command2": "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context follow_me_ctx"
                        }
                	]
                },
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ROUTE_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set WOUT_DNAME TRUE",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                	"SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/routing/delete follow_me_ctx",
                        	"command2" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context default_routing"
                        }
                	]
                }
        	]
        },
        {
        	"Name": "follow_me_set_dname_on_alias_and_routing",
        	"Description": "dName не получен через SIP, на абоненте выставлен, на маршрутизации выставлен. На стороне Б ожидаем dName с маршрутизации",
        	"TestProcedure" : [
                {
                	"SendSSHCommand" : [
                        {
                        	"command1" : "/domain/%%DEV_DOM%%/alias/set %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName %%ALIAS_DNAME%%",
                            "command2": "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%FOLLOW_ME_ROUTE_CONTEXT%%",
                            "command3": "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context follow_me_ctx"
                        }
                	]
                },
                {
                 	"StartUA": [
                        {
                        	"Type": "User",
                            "UserId": 2,
                            "WriteStat" : true,
                            "Name": "Remote_number_UAS",
                            "Commands": [
                                {
                                	 "SourceFile": "simple_ua/uas_recv_bye.xml",
                                	 "Options": "-m 1 -set CHK_DNAME %%ROUTE_DNAME%%",
                                     "NeedAuth": true,
                                     "SippType": "uas",
                                     "Timeout": "40s" 
                                }
                            ]
                        },
                        {
                        	"Type": "User",
                            "UserId": 0,
                            "WriteStat" : true,
                            "Name": "UAC_recv_181",
                            "Commands" : [
                                {
                                	"SourceFile": "simple_ua/uac_send_bye.xml",
                                    "Options": "-m 1 -set CDPN %%1.Number%% -set CDPNDOM %%1.SipDomain%% -set WOUT_DNAME TRUE",
                                    "SippType": "uac",
                                    "NeedAuth": true,
                                    "Timeout": "40s" 
                                }
                            ]
                        }
                 	]
                },
                {
                	"SendSSHCommand" : [
                        {
                            "command1" : "/domain/%%DEV_DOM%%/alias/clean %%0.Number%% %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% displayName",
                            "command2" : "/domain/%%DEV_DOM%%/routing/delete follow_me_ctx",
                        	"command3" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% routing.context default_routing"
                        }
                	]
                }
        	]
        }
    ]
}