{
  "TestName": "fax_test",
  "AutoTest" : "True",
  "Users": [
    {
      "UserId": "1",
      "Number": "155",
      "Login": "155",
      "Password": "123",
      "SipDomain": "pv.ssw3",
      "Expires": "3600",
      "Port": "11106",
      "SipGroup": "sip.ab",
      "QParam": "0.5"
    },
    {
      "UserId": "2",
      "Number": "156",
      "Login": "156",
      "Password": "123",
      "SipDomain": "pv.ssw3",
      "Expires": "3600",
      "Port": "11107",
      "SipGroup": "sip.ab",
      "QParam": "1"
    },
    {
      "UserId": "3",
      "Number": "157",
      "Login": "157",
      "Password": "123",
      "SipDomain": "pv.ssw3",
      "Expires": "3600",
      "Port": "11108",
      "SipGroup": "sip.ab",
      "QParam": "1"
    },
    {
      "UserId": "4",
      "Number": "158",
      "Login": "158",
      "Password": "123",
      "SipDomain": "pv.ssw3",
      "Expires": "3600",
      "Port": "11109",
      "SipGroup": "sip.ab",
      "QParam": "1"
    }
  ],
  "UserVar": [
    {
      "%%FAX_NUMBER%%": "A001",
      "%%USER_DOM%%": "%%DEV_DOM%%",
      "%%FAX_IVR_SCRIPT%%" : "eyJhY3Rpb25zIjp7ImJlZ2luXzEiOnsibmFtZSI6ImJlZ2luIiwicGFyYW1zIjp7ImRlc2NyaXB0aW9uIjoiIn0sInBvcyI6eyJ4IjoxLCJ5IjowfSwiY2FzZXMiOnsibmV4dCI6ImZheF8yIn0sImxpbmtzIjp7Im5leHQiOnsicG9pbnRzIjpbeyJjeCI6MjcwLCJjeSI6NzB9LHsiY3giOjI3MCwiY3kiOjEyNX0seyJjeCI6MjcwLCJjeSI6MTgwfV0sInRleHRfcG9zIjowLjJ9fX0sImZheF8yIjp7Im5hbWUiOiJmYXgiLCJwYXJhbXMiOnsiZGVzY3JpcHRpb24iOiLQotC10YHRgtC+0LLRi9C5INGE0LDQutGBIiwiZW1haWwiOiJlbHRleF90ZXN0ZXJAbWFpbC5ydSIsInN1YmplY3RfbWVzc2FnZSI6ImVsdGV4X3Rlc3RlckBtYWlsLnJ1IiwiYm9keV9tZXNzYWdlIjoiZWx0ZXhfdGVzdGVyQG1haWwucnUiLCJzZW5kZXJfbmFtZSI6ItCi0LXRgdGC0L7QstGL0Lkg0KTQkNCa0KEiLCJmYXhfaWQiOiJGUk9NIFRFU1QiLCJwYXVzZSI6NH0sInBvcyI6eyJ4IjoxLCJ5IjoxfSwiY2FzZXMiOnsiT2siOiJ1bmRlZmluZWQiLCJFcnJvciI6InVuZGVmaW5lZCJ9LCJsaW5rcyI6eyJPayI6eyJwb2ludHMiOlt7ImN4IjoyNzAsImN5IjoyMjB9LHsiY3giOjE4MCwiY3kiOjI3NX0seyJjeCI6OTAsImN5IjozMzB9XSwidGV4dF9wb3MiOjAuMiwicG9zIjp7IngiOjAsInkiOjJ9fSwiRXJyb3IiOnsicG9pbnRzIjpbeyJjeCI6MjcwLCJjeSI6MjIwfSx7ImN4IjoyNzAsImN5IjoyNzV9LHsiY3giOjI3MCwiY3kiOjMzMH1dLCJ0ZXh0X3BvcyI6MC4yLCJwb3MiOnsieCI6MSwieSI6Mn19fX19LCJuYW1lIjoidG9faXZyX2Z1Y2tzIiwiZGVzY3JpcHRpb24iOiIiLCJ2ZXJzaW9uIjoiMy44LjAuMTM5In0=",
      "%%FAX_ROUTE_CONTEXT%%" : "PGNvbnRleHQgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4czpub05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uPSJlY3NzX3JvdXRpbmcueHNkIiBuYW1lPSJ0b19pdnJfZnVja3MiIGRpZ2l0bWFwPSIoKlswLTkqXVswLTkqXS4jfCNbMC05Kl1bMC05Kl0uI3wqI1swLTkqXVswLTkqXS4jfDF4eC58MTB4eC4pIj4NCiAgPHJ1bGUgbmFtZT0idG9fZnVja3MiPg0KICAgIDxjb25kaXRpb25zPg0KICAgICAgPGNkcG4gZGlnaXRzPSJBMDAxIi8+DQogICAgPC9jb25kaXRpb25zPg0KICAgIDxyZXN1bHQ+DQogICAgICA8aXZyIHNjcmlwdD0idG9faXZyX2Z1Y2tzIi8+DQogICAgPC9yZXN1bHQ+DQogIDwvcnVsZT4NCjwvY29udGV4dD4="
    }
  ],
  "PreCoconConf": [
    {
      "command1" : "/domain/%%DEV_DOM%%/media-profile/declare no_t_38 no_t38 system",
      "command2" : "/domain/%%DEV_DOM%%/media-profile/codecs-add no_t_38 image T38 false",
      "command3" : "/domain/%%DEV_DOM%%/alias/set-for-iface %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% media-profile no_t_38",
      "command4" : "/domain/%%DEV_DOM%%/ivr/script/.import --id to_ivr_fucks --json-base64 %%FAX_IVR_SCRIPT%%",
      "command5" : "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%FAX_ROUTE_CONTEXT%%",
      "command6" : "/domain/%%DEV_DOM%%/iface/user-set sip1 %%1.SipGroup%% {%%1.Number%%-%%4.Number%%}@%%1.SipDomain%% routing.context to_ivr_fucks"
    }
  ],
  "PostCoconConf": [
    {
      "command1": "/domain/%%DEV_DOM%%/alias/iface-clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% media-profile",
      "command2": "/domain/%%DEV_DOM%%/media-profile/remove no_t_38",
      "command3": "/domain/%%DEV_DOM%%/ivr/script/delete to_ivr_fucks",
      "command4": "/domain/%%DEV_DOM%%/iface/user-set sip1 %%1.SipGroup%% {%%1.Number%%-%%4.Number%%}@%%1.SipDomain%% routing.context default_routing",
      "command5": "/domain/%%DEV_DOM%%/routing/delete to_ivr_fucks"
    }
  ],
  "Tests": [
    {
      "Name": "test_fax2email_t38",
      "Description": "test_fax2email_t38",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "1",
              "WriteStat" : "True",
              "Name": "UAC_FAX_T38",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_t38.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_fax2email_g711",
      "Description": "test_fax2email_g711",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "2",
              "Name": "UAC_FAX_G711",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_g711.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_fax2email_g711_like_SI3000",
      "Description": "test_fax2email_g711_like_SI3000",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "3",
              "Name": "UAC_FAX_G711_SI300",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_g711_mp.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_fax2email_g711_like_SI3000_send_bye",
      "Description": "test_fax2email_g711_like_SI3000 Bug: #69061",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "3",
              "Name": "UAC_FAX_G711_SI300",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_g711_mp_send_bye.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_fax2email_g711_like_TAU",
      "Description": "test_fax2email_g711_like_TAU",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "4",
              "Name": "UAC_FAX_G711_TAU",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_g711_tau.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_send_bye_on_t38_re_invite",
      "Description": "Если со стороны клиента сделать гонку BYE реквеста и RE-INVITE на T38, то MSR упадёт",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "1",
              "WriteStat" : "True",
              "Name": "UAC_RACE_BYE_AND_RE_INV",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_t38_send_bye_on_re_invite.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "test_t38_send_re_invite",
      "Description": "Проверка, что факс будет принят если юзер отправил re-invite после передачи факса.",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "1",
              "WriteStat" : "True",
              "Name": "UAC_T38_SEND_RE_INVITE",
              "Commands": [
                {
                  "SourceFile": "fax_test/uac_t38_send_re_invite.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "fax_pending_test",
      "Description": "Тестирование обработки встречных реквестов при переходе на t38",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": "1",
              "WriteStat" : "True",
              "Name": "UAC_T38_SEND_RE_INVITE_PENDING",
              "Commands": [
                {
                  "SourceFile": "fax_test/fax_491_test.xml",
                  "Options": "-m 1  -set CDPN %%FAX_NUMBER%% -set CDPNDOM %%USER_DOM%%",
                  "NeedAuth": "True",
                  "SippType": "uac",
                  "Timeout": "200s"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
