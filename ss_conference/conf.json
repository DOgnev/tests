{
  "TestName": "ss_conference",
  "AutoTest": true,
  "Users": [
    {
      "UserId": 0,
      "Number": "150",
      "Login": "150",
      "Password": "123",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "SipGroup": "sip.ab",
      "Port": 10105,
      "QParam": 1
    },
    {
      "UserId": 1,
      "Number": "151",
      "Login": "151",
      "Password": "123",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "SipGroup": "sip.ab",
      "Port": 10106,
      "QParam": 1
    },
    {
      "UserId": 2,
      "Number": "152",
      "Login": "152",
      "Password": "123",
      "SipGroup": "sip.ab",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "Port": 10107,
      "QParam": 1
    },
    {
      "UserId": 3,
      "Number": "153",
      "Login": "153",
      "Password": "123",
      "SipGroup": "sip.ab",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "Port": 10108,
      "QParam": 1
    },
    {
      "UserId": 4,
      "Number": "154",
      "Login": "154",
      "Password": "123",
      "SipGroup": "sip.ab",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "Port": 10109,
      "QParam": 1
    }
  ],
  "UserVar": [
    {
      "%%CTX_TO_CHATROOM%%": "PGNvbnRleHQgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4czpub05hbWVzcGFjZVNjaGVtYUxvY2F0aW9uPSJlY3NzX3JvdXRpbmcueHNkIiBuYW1lPSJjaGF0X3Jvb21fYW5kX2NvbmZfY29uZmxpY3RfdGVzdCIgZGlnaXRtYXA9IigqWzAtOSpdWzAtOSpdLiN8I1swLTkqXVswLTkqXS4jfCojWzAtOSpdWzAtOSpdLiN8MXh4LnwxMHh4LikiPg0KICA8cnVsZSBuYW1lPSJ0b19pdnIiPg0KICAgIDxjb25kaXRpb25zPg0KICAgICAgPGNkcG4gZGlnaXRzPSIlIi8+DQogICAgPC9jb25kaXRpb25zPg0KICAgIDxyZXN1bHQ+DQogICAgICA8aXZyIHNjcmlwdD0iY2hhdF9yb29tX2FuZF9jb25mX2NvbmZsaWN0X3Rlc3QiLz4NCiAgICA8L3Jlc3VsdD4NCiAgPC9ydWxlPg0KPC9jb250ZXh0Pg==",
      "%%CHAT_ROOM_SCRIPT%%": "{\"actions\":{\"begin_1\":{\"name\":\"begin\",\"params\":{\"description\":\"\"},\"pos\":{\"x\":1,\"y\":0},\"cases\":{\"next\":\"ivr_2\"},\"links\":{\"next\":{\"points\":[{\"cx\":270,\"cy\":70},{\"cx\":270,\"cy\":125},{\"cx\":270,\"cy\":180}],\"text_pos\":0.2}}},\"ivr_2\":{\"name\":\"ivr\",\"params\":{\"description\":\"\u041f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435. \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u0442\u0435\u043a\u0442 3-\u0435\u0445 \u0446\u0438\u0444\u0440. \u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f EXTENSION \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0437\u0430\u0434\u0435\u0442\u0435\u043a\u0447\u0435\u043d\u043d\u044b\u043c\u0438 \u0446\u0438\u0444\u0440\u0430\u043c\u0438. \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0432\u043e \u0432\u0435\u0442\u043a\u0435 extension.\",\"play\":[{\"location\":\"system\",\"group\":\"\",\"name\":\"ai_enter_number_of_conference.wav\",\"type\":\"file\",\"variable_type\":\"\"}],\"ivr\":[],\"wait_time\":5,\"extension_dialing\":true,\"direct_call_to_extension\":true,\"category\":\"access_type0\",\"max_digits\":len(%%0.Number%%),\"interdigit_timeout\":2},\"pos\":{\"x\":1,\"y\":1},\"cases\":{\"Extension\":\"set_3\",\"No Match\":\"play_5\"},\"links\":{\"Extension\":{\"points\":[{\"cx\":270,\"cy\":220},{\"cx\":360,\"cy\":275},{\"cx\":450,\"cy\":330}],\"text_pos\":0.2},\"No Match\":{\"points\":[{\"cx\":270,\"cy\":220},{\"cx\":180,\"cy\":275},{\"cx\":90,\"cy\":330}],\"text_pos\":0.2}}},\"set_3\":{\"name\":\"set\",\"params\":{\"description\":\"\u0418\u0437\u043c\u0435\u043d\u044f\u0435\u043c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e EXTENSION.\",\"variables\":[{\"key\":\"EXTENSION\",\"value\":\"*72*%EXTENSION%\"}]},\"pos\":{\"x\":2,\"y\":2},\"cases\":{\"next\":\"dial_4\"},\"links\":{\"next\":{\"points\":[{\"cx\":450,\"cy\":370},{\"cx\":450,\"cy\":425},{\"cx\":450,\"cy\":480}],\"text_pos\":0.2}}},\"dial_4\":{\"name\":\"dial\",\"params\":{\"description\":\"\u0412\u044b\u0437\u043e\u0432 \u043d\u0430 \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u044e \u0441 \u043d\u043e\u043c\u0435\u0440\u043e\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u043c\u0441\u044f \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 EXTENSION.\",\"numbers\":\"EXTENSION\",\"noanswer_timeout\":5},\"pos\":{\"x\":2,\"y\":3},\"cases\":{\"Busy/No answer\":\"undefined\",\"Error\":\"undefined\"},\"links\":{\"Busy/No answer\":{\"points\":[{\"cx\":450,\"cy\":520},{\"cx\":360,\"cy\":575},{\"cx\":270,\"cy\":630}],\"text_pos\":0.2,\"pos\":{\"x\":1,\"y\":4}},\"Error\":{\"points\":[{\"cx\":450,\"cy\":520},{\"cx\":450,\"cy\":575},{\"cx\":450,\"cy\":630}],\"text_pos\":0.2,\"pos\":{\"x\":2,\"y\":4}}}},\"play_5\":{\"name\":\"play\",\"params\":{\"description\":\"\u041d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438.\",\"play\":[{\"location\":\"system\",\"group\":\"\",\"name\":\"ai_invalid_number_of_conference.wav\",\"type\":\"file\",\"variable_type\":\"\"}],\"replay\":\"1\"},\"pos\":{\"x\":0,\"y\":2},\"cases\":{\"next\":\"undefined\"},\"links\":{\"next\":{\"points\":[{\"cx\":90,\"cy\":370},{\"cx\":90,\"cy\":425},{\"cx\":90,\"cy\":480}],\"text_pos\":0.2,\"pos\":{\"x\":0,\"y\":3}}}}},\"name\":\"chat_room_and_conf_conflict_test\",\"description\":\"\u0421\u043a\u0440\u0438\u043f\u0442 \u0432\u0432\u043e\u0434\u0430 \u043d\u043e\u043c\u0435\u0440\u0430 \u043a\u043e\u043c\u043d\u0430\u0442\u044b \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438. \u041d\u043e\u043c\u0435\u0440 \u043a\u043e\u043c\u043d\u0430\u0442\u044b \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438 \u0432\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0431\u043b\u043e\u043a\u0435 ivr. \u0412\u0445\u043e\u0434 \u0432 \u043a\u043e\u043c\u043d\u0430\u0442\u0443 \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u0446\u0438\u0438 \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0431\u043b\u043e\u043a\u043e\u043c dial.\",\"version\":\"3.9.0.266\"}",
      "%%ROOM_NUMBER%%": "%%0.Number%%"
    }
  ],
  "PreConf": [
    "/domain/%%DEV_DOM%%/ss/enable %%0.Number%% chold",
    "/domain/%%DEV_DOM%%/ss/activate %%0.Number%% chold",
    "/domain/%%DEV_DOM%%/ss/enable %%0.Number%% ctr",
    "/domain/%%DEV_DOM%%/ss/activate %%0.Number%% ctr",
    "/domain/%%DEV_DOM%%/ss/enable %%0.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/activate %%0.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/enable %%0.Number%% clip",
    "/domain/%%DEV_DOM%%/ss/activate %%0.Number%% clip",
    "/domain/%%DEV_DOM%%/ss/enable %%3.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/activate %%3.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/enable %%4.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/activate %%4.Number%% conference",
    "/domain/%%DEV_DOM%%/routing/.xbin/.import-context --xml-base64 %%CTX_TO_CHATROOM%%",
    "/domain/%%DEV_DOM%%/ivr/script/.import --id chat_room_and_conf_conflict_test --json %%CHAT_ROOM_SCRIPT%%",
    "/domain/%%DEV_DOM%%/sip/user/set %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% remote-ctr-indication rpi",
    "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% remote-ctr-indication rpi",
    "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% remote-ctr-indication rpi",
    "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% remote-ctr-indication none",
    "/domain/%%DEV_DOM%%/sip/user/set %%4.SipGroup%% %%4.Number%%@%%4.SipDomain%% remote-ctr-indication none"
  ],
  "PostConf": [
    "/domain/%%DEV_DOM%%/ss/deactivate %%0.Number%% chold",
    "/domain/%%DEV_DOM%%/ss/disable %%0.Number%% chold",
    "/domain/%%DEV_DOM%%/ss/deactivate %%0.Number%% ctr",
    "/domain/%%DEV_DOM%%/ss/disable %%0.Number%% ctr",
    "/domain/%%DEV_DOM%%/ss/deactivate %%0.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/disable %%0.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/deactivate %%0.Number%% clip",
    "/domain/%%DEV_DOM%%/ss/disable %%0.Number%% clip",
    "/domain/%%DEV_DOM%%/ss/deactivate %%3.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/disable %%3.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/deactivate %%4.Number%% conference",
    "/domain/%%DEV_DOM%%/ss/disable %%4.Number%% conference",
    "/domain/%%DEV_DOM%%/routing/delete chat_room_and_conf_conflict_test",
    "domain/%%DEV_DOM%%/ivr/script/delete chat_room_and_conf_conflict_test",
    "/domain/%%DEV_DOM%%/sip/user/clean %%0.SipGroup%% %%0.Number%%@%%0.SipDomain%% remote-ctr-indication --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% remote-ctr-indication --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% remote-ctr-indication --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% remote-ctr-indication --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%4.SipGroup%% %%4.Number%%@%%4.SipDomain%% remote-ctr-indication --force"
  ],
  "Tests": [
    {
      "Name": "create_conf_refer_to_focus",
      "Description": "\u0422\u0435\u0441\u0442 \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438 refer2focus",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 0,
              "Name": "UAS1_REFER_TO_FOCUS",
              "Commands": [
                {
                  "SourceFile": "ss_conference/conf_refer_to_focus.xml",
                  "Options": "-m 1 -set CALL2_NUMBER %%1.Number%% -set CALL2_DOMAIN %%1.SipDomain%% -d 5000",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "SIMPLE_UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uas_recv_update_in_confir_st.xml",
                  "Options": "-m 1 -d 4000 -set CONFNUM *C71%23",
                  "SippType": "uas",
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 2,
              "Name": "SIMPLE_UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uac_recv_update.xml",
                  "Options": "-m 1 -d 4000 -set CDPN %%0.Number%% -set CDPNDOM %%0.SipDomain%% -set CONFNUM *C71%23",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "create_conf_refer_to_user",
      "Description": "\u0422\u0435\u0441\u0442 \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438 refer2user",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 0,
              "Name": "UAS1_REFER_TO_USER",
              "Commands": [
                {
                  "SourceFile": "ss_conference/conf_refer_to_user.xml",
                  "Options": "-m 1 -set CALL2_NUMBER %%1.Number%% -set CALL2_DOMAIN %%1.SipDomain%% -d 5000",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "SIMPLE_UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uas_recv_update_in_confir_st.xml",
                  "Options": "-m 1 -d 4000 -set CONFNUM *71%23",
                  "SippType": "uas",
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 2,
              "Name": "SIMPLE_UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uac_recv_update.xml",
                  "Options": "-m 1 -d 4000 -set CDPN %%0.Number%% -set CDPNDOM %%0.SipDomain%% -set CONFNUM *71%23",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "create_conf_like_cisco",
      "Description": "\u0422\u0435\u0441\u0442 \u0441\u0431\u043e\u0440\u0430 cisco \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438",
      "TestProcedure": [
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 0,
              "Name": "UAS1_CREATE_CONF_LIKE_CISCO",
              "Commands": [
                {
                  "SourceFile": "ss_conference/ss_cisco_conf.xml",
                  "Options": "-m 2 -set CALL2_NUMBER %%1.Number%% -set CALL2_DOMAIN %%1.SipDomain%% -d 5000",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "SIMPLE_UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uas_recv_update_in_confir_st.xml",
                  "Options": "-m 1 -d 4000 -set CONFNUM *C71%23",
                  "SippType": "uas",
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 2,
              "Name": "SIMPLE_UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uac_recv_update.xml",
                  "Options": "-m 1 -d 4000 -set CDPN %%0.Number%% -set CDPNDOM %%0.SipDomain%% -set CONFNUM *C71%23",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "Name": "chat_room_and_conference_conflict_test",
      "Ref": "#92405",
      "Description": "\u0421\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u044e \u0441 \u043d\u043e\u043c\u0435\u0440\u0430 A. \u0414\u0430\u043b\u0435\u0435 \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u043c chat-room \u0441 \u043d\u043e\u043c\u0435\u0440\u043e\u043c \u043a\u043e\u043c\u0430\u043d\u0442\u044b \u0440\u0430\u0432\u043d\u043e\u043c \u043d\u043e\u043c\u0435\u0440\u0443 \u0410. \u041d\u0438\u043a\u0430\u043a\u0438\u0445 \u043e\u0442\u0431\u043e\u0435\u0432 \u0431\u044b\u0442\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e, \u043a\u043e\u043d\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0438 \u0436\u0438\u0432\u0443\u0442 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/iface/user-set sip1 %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% routing.context chat_room_and_conf_conflict_test",
            "/domain/%%DEV_DOM%%/iface/user-set sip1 %%4.SipGroup%% %%4.Number%%@%%4.SipDomain%% routing.context chat_room_and_conf_conflict_test"
          ]
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 0,
              "BackGround": true,
              "Name": "UAS1_REFER_TO_FOCUS",
              "Commands": [
                {
                  "SourceFile": "ss_conference/conf_refer_to_focus.xml",
                  "Options": "-m 1 -set CALL2_NUMBER %%1.Number%% -set CALL2_DOMAIN %%1.SipDomain%% -d 10000",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "SIMPLE_UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uas_recv_update_in_confir_st.xml",
                  "Options": "-m 1 -d 4000 -set CONFNUM *C71%23",
                  "SippType": "uas",
                  "Timeout": "30s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 2,
              "Name": "SIMPLE_UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "ss_conference/uac_recv_update.xml",
                  "Options": "-m 1 -d 4000 -set CDPN %%0.Number%% -set CDPNDOM %%0.SipDomain%% -set CONFNUM *C71%23",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "30s"
                }
              ]
            }
          ]
        },
        {
          "Sleep": 10
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 3,
              "Name": "UAC1_CHATROOM_SEND_BYE",
              "Commands": [
                {
                  "SourceFile": "ivr/uac_send_dtmf_and_send_bye.xml",
                  "Options": "-m 1 -set CDPN b001 -set CDPNDOM %%0.SipDomain%% -d 3000 -set DIGITS %%ROOM_NUMBER%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "80s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 4,
              "Name": "UAC2_CHATROOM_SEND_BYE",
              "Commands": [
                {
                  "SourceFile": "ivr/uac_send_dtmf_and_send_bye.xml",
                  "Options": "-m 1 -set CDPN b001 -set CDPNDOM %%0.SipDomain%% -d 3000 -set DIGITS %%ROOM_NUMBER%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "80s"
                }
              ]
            }
          ]
        },
        {
          "Sleep": 10
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/iface/user-set sip1 %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% routing.context default_routing",
            "/domain/%%DEV_DOM%%/iface/user-set sip1 %%4.SipGroup%% %%4.Number%%@%%4.SipDomain%% routing.context default_routing"
          ]
        }
      ]
    }
  ]
}